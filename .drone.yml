kind: pipeline
type: exec
name: default

trigger:
  event:
    - push

steps:
  - name: build
    commands:
      - docker build -t localtun .
  - name: deploy
    commands:
      - docker rm -f localtun || true
      - >
        docker run --restart=always --name localtun -d -p 1022
        --label="traefik.http.routers.localtun.rule=HostRegexp(\`{subdomain:[a-z0-9]+}.app.pywebio.online\`, \`app.pywebio.online\`)"
        --label="traefik.http.services.localtun.loadbalancer.server.port=80"
        localtun